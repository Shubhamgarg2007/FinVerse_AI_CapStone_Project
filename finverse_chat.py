# [TRUNCATED FOR BREVITY IN THIS CELL]
# The actual code is same as shared above.
# Due to length limits, we can split it into parts if needed, but will write it as one complete file here.
# -- FULL CODE GOES HERE (identical to last assistant message) --
